
============================================================
Running MoE BioFormer Integration Test: /home/tripham/scgpt/benchmark/preprocessed_pbmc
Checkpoint: /mnt/nasdev2/dung/training_1k/checkpoints/checkpoint_epoch_3_20250709_210643.pt
============================================================
Loaded 1000 genes from vocabulary
Loaded 11990 cells from 2 studies
Found 9 unique cell types
Loading MoE BioFormer model...
MoE model loaded successfully
Extracting embeddings...
Processing batches:   0%|          | 0/188 [00:00<?, ?it/s]Processing batches:   1%|          | 1/188 [00:00<00:52,  3.56it/s]Processing batches:   1%|          | 2/188 [00:00<00:41,  4.51it/s]Processing batches:   2%|▏         | 3/188 [00:00<00:37,  4.95it/s]Processing batches:   2%|▏         | 4/188 [00:00<00:35,  5.18it/s]Processing batches:   3%|▎         | 5/188 [00:00<00:34,  5.32it/s]Processing batches:   3%|▎         | 6/188 [00:01<00:33,  5.41it/s]Processing batches:   4%|▎         | 7/188 [00:01<00:33,  5.47it/s]Processing batches:   4%|▍         | 8/188 [00:01<00:32,  5.51it/s]Processing batches:   5%|▍         | 9/188 [00:01<00:32,  5.53it/s]Processing batches:   5%|▌         | 10/188 [00:01<00:32,  5.55it/s]Processing batches:   6%|▌         | 11/188 [00:02<00:31,  5.57it/s]Processing batches:   6%|▋         | 12/188 [00:02<00:31,  5.58it/s]Processing batches:   7%|▋         | 13/188 [00:02<00:31,  5.58it/s]Processing batches:   7%|▋         | 14/188 [00:02<00:31,  5.59it/s]Processing batches:   8%|▊         | 15/188 [00:02<00:30,  5.59it/s]Processing batches:   9%|▊         | 16/188 [00:02<00:30,  5.59it/s]Processing batches:   9%|▉         | 17/188 [00:03<00:30,  5.59it/s]Processing batches:  10%|▉         | 18/188 [00:03<00:30,  5.59it/s]Processing batches:  10%|█         | 19/188 [00:03<00:30,  5.59it/s]Processing batches:  11%|█         | 20/188 [00:03<00:30,  5.59it/s]Processing batches:  11%|█         | 21/188 [00:03<00:29,  5.59it/s]Processing batches:  12%|█▏        | 22/188 [00:04<00:29,  5.59it/s]Processing batches:  12%|█▏        | 23/188 [00:04<00:29,  5.59it/s]Processing batches:  13%|█▎        | 24/188 [00:04<00:29,  5.59it/s]Processing batches:  13%|█▎        | 25/188 [00:04<00:29,  5.60it/s]Processing batches:  14%|█▍        | 26/188 [00:04<00:28,  5.60it/s]Processing batches:  14%|█▍        | 27/188 [00:04<00:28,  5.60it/s]Processing batches:  15%|█▍        | 28/188 [00:05<00:28,  5.60it/s]Processing batches:  15%|█▌        | 29/188 [00:05<00:28,  5.60it/s]Processing batches:  16%|█▌        | 30/188 [00:05<00:28,  5.60it/s]Processing batches:  16%|█▋        | 31/188 [00:05<00:28,  5.60it/s]Processing batches:  17%|█▋        | 32/188 [00:05<00:27,  5.60it/s]Processing batches:  18%|█▊        | 33/188 [00:06<00:27,  5.60it/s]Processing batches:  18%|█▊        | 34/188 [00:06<00:27,  5.60it/s]Processing batches:  19%|█▊        | 35/188 [00:06<00:27,  5.60it/s]Processing batches:  19%|█▉        | 36/188 [00:06<00:27,  5.60it/s]Processing batches:  20%|█▉        | 37/188 [00:06<00:26,  5.60it/s]Processing batches:  20%|██        | 38/188 [00:06<00:26,  5.60it/s]Processing batches:  21%|██        | 39/188 [00:07<00:26,  5.60it/s]Processing batches:  21%|██▏       | 40/188 [00:07<00:26,  5.60it/s]Processing batches:  22%|██▏       | 41/188 [00:07<00:26,  5.60it/s]Processing batches:  22%|██▏       | 42/188 [00:07<00:26,  5.59it/s]Processing batches:  23%|██▎       | 43/188 [00:07<00:25,  5.59it/s]Processing batches:  23%|██▎       | 44/188 [00:07<00:25,  5.59it/s]Processing batches:  24%|██▍       | 45/188 [00:08<00:25,  5.59it/s]Processing batches:  24%|██▍       | 46/188 [00:08<00:25,  5.59it/s]Processing batches:  25%|██▌       | 47/188 [00:08<00:25,  5.60it/s]Processing batches:  26%|██▌       | 48/188 [00:08<00:25,  5.60it/s]Processing batches:  26%|██▌       | 49/188 [00:08<00:24,  5.60it/s]Processing batches:  27%|██▋       | 50/188 [00:09<00:24,  5.60it/s]Processing batches:  27%|██▋       | 51/188 [00:09<00:24,  5.60it/s]Processing batches:  28%|██▊       | 52/188 [00:09<00:24,  5.60it/s]Processing batches:  28%|██▊       | 53/188 [00:09<00:24,  5.59it/s]Processing batches:  29%|██▊       | 54/188 [00:09<00:23,  5.59it/s]Processing batches:  29%|██▉       | 55/188 [00:09<00:23,  5.59it/s]Processing batches:  30%|██▉       | 56/188 [00:10<00:23,  5.60it/s]Processing batches:  30%|███       | 57/188 [00:10<00:23,  5.59it/s]Processing batches:  31%|███       | 58/188 [00:10<00:23,  5.59it/s]Processing batches:  31%|███▏      | 59/188 [00:10<00:23,  5.60it/s]Processing batches:  32%|███▏      | 60/188 [00:10<00:22,  5.59it/s]Processing batches:  32%|███▏      | 61/188 [00:11<00:22,  5.59it/s]Processing batches:  33%|███▎      | 62/188 [00:11<00:22,  5.59it/s]Processing batches:  34%|███▎      | 63/188 [00:11<00:22,  5.59it/s]Processing batches:  34%|███▍      | 64/188 [00:11<00:22,  5.59it/s]Processing batches:  35%|███▍      | 65/188 [00:11<00:21,  5.59it/s]Processing batches:  35%|███▌      | 66/188 [00:11<00:21,  5.59it/s]Processing batches:  36%|███▌      | 67/188 [00:12<00:21,  5.59it/s]Processing batches:  36%|███▌      | 68/188 [00:12<00:21,  5.59it/s]Processing batches:  37%|███▋      | 69/188 [00:12<00:21,  5.60it/s]Processing batches:  37%|███▋      | 70/188 [00:12<00:21,  5.59it/s]Processing batches:  38%|███▊      | 71/188 [00:12<00:20,  5.59it/s]Processing batches:  38%|███▊      | 72/188 [00:12<00:20,  5.59it/s]Processing batches:  39%|███▉      | 73/188 [00:13<00:20,  5.59it/s]Processing batches:  39%|███▉      | 74/188 [00:13<00:20,  5.60it/s]Processing batches:  40%|███▉      | 75/188 [00:13<00:20,  5.60it/s]Processing batches:  40%|████      | 76/188 [00:13<00:20,  5.60it/s]Processing batches:  41%|████      | 77/188 [00:13<00:19,  5.60it/s]Processing batches:  41%|████▏     | 78/188 [00:14<00:19,  5.60it/s]Processing batches:  42%|████▏     | 79/188 [00:14<00:19,  5.60it/s]Processing batches:  43%|████▎     | 80/188 [00:14<00:19,  5.60it/s]Processing batches:  43%|████▎     | 81/188 [00:14<00:19,  5.60it/s]Processing batches:  44%|████▎     | 82/188 [00:14<00:18,  5.60it/s]Processing batches:  44%|████▍     | 83/188 [00:14<00:18,  5.59it/s]Processing batches:  45%|████▍     | 84/188 [00:15<00:18,  5.59it/s]Processing batches:  45%|████▌     | 85/188 [00:15<00:18,  5.59it/s]Processing batches:  46%|████▌     | 86/188 [00:15<00:18,  5.60it/s]Processing batches:  46%|████▋     | 87/188 [00:15<00:18,  5.60it/s]Processing batches:  47%|████▋     | 88/188 [00:15<00:17,  5.60it/s]Processing batches:  47%|████▋     | 89/188 [00:16<00:17,  5.60it/s]Processing batches:  48%|████▊     | 90/188 [00:16<00:17,  5.59it/s]Processing batches:  48%|████▊     | 91/188 [00:16<00:17,  5.60it/s]Processing batches:  49%|████▉     | 92/188 [00:16<00:17,  5.60it/s]Processing batches:  49%|████▉     | 93/188 [00:16<00:16,  5.60it/s]Processing batches:  50%|█████     | 94/188 [00:16<00:16,  5.59it/s]Processing batches:  51%|█████     | 95/188 [00:17<00:16,  5.59it/s]Processing batches:  51%|█████     | 96/188 [00:17<00:16,  5.59it/s]Processing batches:  52%|█████▏    | 97/188 [00:17<00:16,  5.59it/s]Processing batches:  52%|█████▏    | 98/188 [00:17<00:16,  5.60it/s]Processing batches:  53%|█████▎    | 99/188 [00:17<00:15,  5.59it/s]Processing batches:  53%|█████▎    | 100/188 [00:17<00:15,  5.59it/s]Processing batches:  54%|█████▎    | 101/188 [00:18<00:15,  5.59it/s]Processing batches:  54%|█████▍    | 102/188 [00:18<00:15,  5.59it/s]Processing batches:  55%|█████▍    | 103/188 [00:18<00:15,  5.59it/s]Processing batches:  55%|█████▌    | 104/188 [00:18<00:15,  5.60it/s]Processing batches:  56%|█████▌    | 105/188 [00:18<00:14,  5.59it/s]Processing batches:  56%|█████▋    | 106/188 [00:19<00:14,  5.59it/s]Processing batches:  57%|█████▋    | 107/188 [00:19<00:14,  5.59it/s]Processing batches:  57%|█████▋    | 108/188 [00:19<00:14,  5.59it/s]Processing batches:  58%|█████▊    | 109/188 [00:19<00:14,  5.59it/s]Processing batches:  59%|█████▊    | 110/188 [00:19<00:13,  5.59it/s]Processing batches:  59%|█████▉    | 111/188 [00:19<00:13,  5.59it/s]Processing batches:  60%|█████▉    | 112/188 [00:20<00:13,  5.60it/s]Processing batches:  60%|██████    | 113/188 [00:20<00:13,  5.59it/s]Processing batches:  61%|██████    | 114/188 [00:20<00:13,  5.59it/s]Processing batches:  61%|██████    | 115/188 [00:20<00:13,  5.60it/s]Processing batches:  62%|██████▏   | 116/188 [00:20<00:12,  5.60it/s]Processing batches:  62%|██████▏   | 117/188 [00:21<00:12,  5.60it/s]Processing batches:  63%|██████▎   | 118/188 [00:21<00:12,  5.60it/s]Processing batches:  63%|██████▎   | 119/188 [00:21<00:12,  5.59it/s]Processing batches:  64%|██████▍   | 120/188 [00:21<00:12,  5.59it/s]Processing batches:  64%|██████▍   | 121/188 [00:21<00:11,  5.59it/s]Processing batches:  65%|██████▍   | 122/188 [00:21<00:11,  5.59it/s]Processing batches:  65%|██████▌   | 123/188 [00:22<00:11,  5.58it/s]Processing batches:  66%|██████▌   | 124/188 [00:22<00:11,  5.58it/s]Processing batches:  66%|██████▋   | 125/188 [00:22<00:11,  5.59it/s]Processing batches:  67%|██████▋   | 126/188 [00:22<00:11,  5.59it/s]Processing batches:  68%|██████▊   | 127/188 [00:22<00:10,  5.59it/s]Processing batches:  68%|██████▊   | 128/188 [00:22<00:10,  5.59it/s]Processing batches:  69%|██████▊   | 129/188 [00:23<00:10,  5.59it/s]Processing batches:  69%|██████▉   | 130/188 [00:23<00:10,  5.59it/s]Processing batches:  70%|██████▉   | 131/188 [00:23<00:10,  5.59it/s]Processing batches:  70%|███████   | 132/188 [00:23<00:10,  5.59it/s]Processing batches:  71%|███████   | 133/188 [00:23<00:09,  5.60it/s]Processing batches:  71%|███████▏  | 134/188 [00:24<00:09,  5.59it/s]Processing batches:  72%|███████▏  | 135/188 [00:24<00:09,  5.59it/s]Processing batches:  72%|███████▏  | 136/188 [00:24<00:09,  5.59it/s]Processing batches:  73%|███████▎  | 137/188 [00:24<00:09,  5.59it/s]Processing batches:  73%|███████▎  | 138/188 [00:24<00:08,  5.59it/s]Processing batches:  74%|███████▍  | 139/188 [00:24<00:08,  5.60it/s]Processing batches:  74%|███████▍  | 140/188 [00:25<00:08,  5.60it/s]Processing batches:  75%|███████▌  | 141/188 [00:25<00:08,  5.59it/s]Processing batches:  76%|███████▌  | 142/188 [00:25<00:08,  5.59it/s]Processing batches:  76%|███████▌  | 143/188 [00:25<00:08,  5.59it/s]Processing batches:  77%|███████▋  | 144/188 [00:25<00:07,  5.60it/s]Processing batches:  77%|███████▋  | 145/188 [00:26<00:07,  5.60it/s]Processing batches:  78%|███████▊  | 146/188 [00:26<00:07,  5.60it/s]Processing batches:  78%|███████▊  | 147/188 [00:26<00:07,  5.60it/s]Processing batches:  79%|███████▊  | 148/188 [00:26<00:07,  5.60it/s]Processing batches:  79%|███████▉  | 149/188 [00:26<00:06,  5.60it/s]Processing batches:  80%|███████▉  | 150/188 [00:26<00:06,  5.60it/s]Processing batches:  80%|████████  | 151/188 [00:27<00:06,  5.60it/s]Processing batches:  81%|████████  | 152/188 [00:27<00:06,  5.60it/s]Processing batches:  81%|████████▏ | 153/188 [00:27<00:06,  5.60it/s]Processing batches:  82%|████████▏ | 154/188 [00:27<00:06,  5.60it/s]Processing batches:  82%|████████▏ | 155/188 [00:27<00:05,  5.60it/s]Processing batches:  83%|████████▎ | 156/188 [00:27<00:05,  5.60it/s]Processing batches:  84%|████████▎ | 157/188 [00:28<00:05,  5.60it/s]Processing batches:  84%|████████▍ | 158/188 [00:28<00:05,  5.60it/s]Processing batches:  85%|████████▍ | 159/188 [00:28<00:05,  5.59it/s]Processing batches:  85%|████████▌ | 160/188 [00:28<00:05,  5.60it/s]Processing batches:  86%|████████▌ | 161/188 [00:28<00:04,  5.60it/s]Processing batches:  86%|████████▌ | 162/188 [00:29<00:04,  5.60it/s]Processing batches:  87%|████████▋ | 163/188 [00:29<00:04,  5.60it/s]Processing batches:  87%|████████▋ | 164/188 [00:29<00:04,  5.60it/s]Processing batches:  88%|████████▊ | 165/188 [00:29<00:04,  5.60it/s]Processing batches:  88%|████████▊ | 166/188 [00:29<00:03,  5.60it/s]Processing batches:  89%|████████▉ | 167/188 [00:29<00:03,  5.60it/s]Processing batches:  89%|████████▉ | 168/188 [00:30<00:03,  5.59it/s]Processing batches:  90%|████████▉ | 169/188 [00:30<00:03,  5.58it/s]Processing batches:  90%|█████████ | 170/188 [00:30<00:03,  5.58it/s]Processing batches:  91%|█████████ | 171/188 [00:30<00:03,  5.59it/s]Processing batches:  91%|█████████▏| 172/188 [00:30<00:02,  5.59it/s]Processing batches:  92%|█████████▏| 173/188 [00:31<00:02,  5.59it/s]Processing batches:  93%|█████████▎| 174/188 [00:31<00:02,  5.59it/s]Processing batches:  93%|█████████▎| 175/188 [00:31<00:02,  5.59it/s]Processing batches:  94%|█████████▎| 176/188 [00:31<00:02,  5.59it/s]Processing batches:  94%|█████████▍| 177/188 [00:31<00:01,  5.60it/s]Processing batches:  95%|█████████▍| 178/188 [00:31<00:01,  5.59it/s]Processing batches:  95%|█████████▌| 179/188 [00:32<00:01,  5.59it/s]Processing batches:  96%|█████████▌| 180/188 [00:32<00:01,  5.59it/s]Processing batches:  96%|█████████▋| 181/188 [00:32<00:01,  5.59it/s]Processing batches:  97%|█████████▋| 182/188 [00:32<00:01,  5.59it/s]Processing batches:  97%|█████████▋| 183/188 [00:32<00:00,  5.59it/s]Processing batches:  98%|█████████▊| 184/188 [00:32<00:00,  5.59it/s]Processing batches:  98%|█████████▊| 185/188 [00:33<00:00,  5.59it/s]Processing batches:  99%|█████████▉| 186/188 [00:33<00:00,  5.59it/s]Processing batches:  99%|█████████▉| 187/188 [00:33<00:00,  5.59it/s]Processing batches: 100%|██████████| 188/188 [00:33<00:00,  5.60it/s]
Extracted embeddings shape: (11990, 256)

MoE BioFormer Results:
  NMI = 0.7148
  ARI = 0.3103
  Silhouette = 0.8194
  Graph connectivity = 0.9991
  AvgBIO = 0.6148
  AvgBATCH = 0.9991

Generating UMAP visualizations...
UMAP plots saved to: umap_moe_validation_epoch_3.png

MoE Integration Test Completed!
